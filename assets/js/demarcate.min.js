var Showdown={extensions:{}},forEach=Showdown.forEach=function(a,b){if("function"==typeof a.forEach)a.forEach(b);else{var c,d=a.length;for(c=0;d>c;c++)b(a[c],c,a)}},stdExtName=function(a){return a.replace(/[_-]||\s/g,"").toLowerCase()};Showdown.converter=function(a){var b,c,d,e=0,f=[],g=[];if("undefind"!=typeof module&&"undefined"!=typeof exports&&"undefind"!=typeof require){var h=require("fs");if(h){var i=h.readdirSync((__dirname||".")+"/extensions").filter(function(a){return~a.indexOf(".js")}).map(function(a){return a.replace(/\.js$/,"")});Showdown.forEach(i,function(a){var b=stdExtName(a);Showdown.extensions[b]=require("./extensions/"+a)})}}if(this.makeHtml=function(a){return b={},c={},d=[],a=a.replace(/~/g,"~T"),a=a.replace(/\$/g,"~D"),a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a="\n\n"+a+"\n\n",a=M(a),a=a.replace(/^[ \t]+$/gm,""),Showdown.forEach(f,function(b){a=k(b,a)}),a=z(a),a=m(a),a=l(a),a=o(a),a=K(a),a=a.replace(/~D/g,"$$"),a=a.replace(/~T/g,"~"),Showdown.forEach(g,function(b){a=k(b,a)}),a},a&&a.extensions){var j=this;Showdown.forEach(a.extensions,function(a){if("string"==typeof a&&(a=Showdown.extensions[stdExtName(a)]),"function"!=typeof a)throw"Extension '"+a+"' could not be loaded.  It was either not found or is not a valid extension.";Showdown.forEach(a(j),function(a){a.type?"language"===a.type||"lang"===a.type?f.push(a):("output"===a.type||"html"===a.type)&&g.push(a):g.push(a)})})}var w,k=function(a,b){if(a.regex){var c=RegExp(a.regex,"g");return b.replace(c,a.replace)}return a.filter?a.filter(b):void 0},l=function(a){return a+="~0",a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|(?=~0))/gm,function(a,d,e,f,g){return d=d.toLowerCase(),b[d]=G(e),f?f+g:(g&&(c[d]=g.replace(/"/g,"&quot;")),"")}),a=a.replace(/~0/,"")},m=function(a){return a=a.replace(/\n/g,"\n\n"),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,n),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,n),a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n),a=a.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,n),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n),a=a.replace(/\n\n/g,"\n")},n=function(a,b){var c=b;return c=c.replace(/\n\n/g,"\n"),c=c.replace(/^\n/,""),c=c.replace(/\n+$/g,""),c="\n\n~K"+(d.push(c)-1)+"K\n\n"},o=function(a){a=v(a);var b=A("<hr />");return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,b),a=a.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,b),a=x(a),a=y(a),a=E(a),a=m(a),a=F(a)},p=function(a){return a=B(a),a=q(a),a=H(a),a=t(a),a=r(a),a=I(a),a=G(a),a=D(a),a=a.replace(/  +\n/g," <br />\n")},q=function(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=N(b,"\\`*_")})},r=function(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,s),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,s),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,s)},s=function(a,d,e,f,g,h,i,j){void 0==j&&(j="");var k=d,l=e,m=f.toLowerCase(),n=g,o=j;if(""==n)if(""==m&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m,void 0!=b[m])n=b[m],void 0!=c[m]&&(o=c[m]);else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}n=N(n,"*_");var p='<a href="'+n+'"';return""!=o&&(o=o.replace(/"/g,"&quot;"),o=N(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>"},t=function(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,u),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,u)},u=function(a,d,e,f,g,h,i,j){var k=d,l=e,m=f.toLowerCase(),n=g,o=j;if(o||(o=""),""==n){if(""==m&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m,void 0==b[m])return k;n=b[m],void 0!=c[m]&&(o=c[m])}l=l.replace(/"/g,"&quot;"),n=N(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=o.replace(/"/g,"&quot;"),o=N(o,"*_"),p+=' title="'+o+'"',p+=" />"},v=function(a){function b(a){return a.replace(/[^\w]/g,"").toLowerCase()}return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,c){return A('<h1 id="'+b(c)+'">'+p(c)+"</h1>")}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,c){return A('<h2 id="'+b(c)+'">'+p(c)+"</h2>")}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,c,d){var e=c.length;return A("<h"+e+' id="'+b(d)+'">'+p(d)+"</h"+e+">")})},x=function(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return e?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol";d=d.replace(/\n{2,}/g,"\n\n\n");var f=w(d);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n"}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",f=f.replace(/\n{2,}/g,"\n\n\n"),h=w(f);return h=e+"<"+g+">\n"+h+"</"+g+">\n"})),a=a.replace(/~0/,"")};w=function(a){return e++,a=a.replace(/\n{2,}$/,"\n"),a+="~0",a=a.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(a,b,c,d,e){var f=e,g=b;return g||f.search(/\n{2,}/)>-1?f=o(L(f)):(f=x(L(f)),f=f.replace(/\n$/,""),f=p(f)),"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),e--,a};var y=function(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=C(L(d)),d=M(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>",A(d)+e}),a=a.replace(/~0/,"")},z=function(a){return a+="~0",a=a.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(a,b,c){var d=b,e=c;return e=C(e),e=M(e),e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,""),e="<pre><code"+(d?' class="'+d+'"':"")+">"+e+"\n</code></pre>",A(e)}),a=a.replace(/~0/,"")},A=function(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(d.push(a)-1)+"K\n\n"},B=function(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=C(f),b+"<code>"+f+"</code>"})},C=function(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=N(a,"*_{}[]\\",!1)},D=function(a){return a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},E=function(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=o(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /gm,"~0"),c=c.replace(/~0/g,"")}),A("<blockquote>\n"+c+"\n</blockquote>")})},F=function(a){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");for(var b=a.split(/\n{2,}/g),c=[],e=b.length,f=0;e>f;f++){var g=b[f];g.search(/~K(\d+)K/g)>=0?c.push(g):g.search(/\S/)>=0&&(g=p(g),g=g.replace(/^([ \t]*)/g,"<p>"),g+="</p>",c.push(g))}e=c.length;for(var f=0;e>f;f++)for(;c[f].search(/~K(\d+)K/)>=0;){var h=d[RegExp.$1];h=h.replace(/\$/g,"$$$$"),c[f]=c[f].replace(/~K\d+K/,h)}return c.join("\n\n")},G=function(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},H=function(a){return a=a.replace(/\\(\\)/g,O),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,O)},I=function(a){return a=a.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),a=a.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(a,b){return J(K(b))})},J=function(a){var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+a.charCodeAt(0).toString(16)+";"},function(a){return a}];return a="mailto:"+a,a=a.replace(/./g,function(a){if("@"==a)a=b[Math.floor(2*Math.random())](a);else if(":"!=a){var c=Math.random();a=c>.9?b[2](a):c>.45?b[1](a):b[0](a)}return a}),a='<a href="'+a+'">'+a+"</a>",a=a.replace(/">.+:/g,'">')},K=function(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})},L=function(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,"")},M=function(a){return a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"~A~B"),a=a.replace(/~B(.+?)~A/g,function(a,b){for(var d=b,e=4-d.length%4,f=0;e>f;f++)d+=" ";return d}),a=a.replace(/~A/g,"    "),a=a.replace(/~B/g,"")},N=function(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=RegExp(d,"g");return a=a.replace(e,O)},O=function(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}},"undefined"!=typeof module&&(module.exports=Showdown),"function"==typeof define&&define.amd&&define("showdown",function(){return Showdown});
(function($){var
defaults={className:'autosizejs',append:"",callback:false},hidden='hidden',borderBox='border-box',lineHeight='lineHeight',copy='<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;"/>',copyStyle=['fontFamily','fontSize','fontWeight','fontStyle','letterSpacing','textTransform','wordSpacing','textIndent'],oninput='oninput',onpropertychange='onpropertychange',mirrored,mirror=$(copy).data('autosize',true)[0];mirror.style.lineHeight='99px';if($(mirror).css(lineHeight)==='99px'){copyStyle.push(lineHeight);}
mirror.style.lineHeight='';$.fn.autosize=function(options){options=$.extend({},defaults,options||{});if(mirror.parentNode!==document.body){$(document.body).append(mirror);}
return this.each(function(){var
ta=this,$ta=$(ta),minHeight=$ta.height(),maxHeight=parseInt($ta.css('maxHeight'),10),active,resize,boxOffset=0,value=ta.value,callback=$.isFunction(options.callback);if($ta.data('autosize')){return;}
if($ta.css('box-sizing')===borderBox||$ta.css('-moz-box-sizing')===borderBox||$ta.css('-webkit-box-sizing')===borderBox){boxOffset=$ta.outerHeight()-$ta.height();}
resize=$ta.css('resize')==='none'?'none':'horizontal';$ta.css({overflow:hidden,overflowY:hidden,wordWrap:'break-word',resize:resize}).data('autosize',true);maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4;function initMirror(){mirrored=ta;mirror.className=options.className;$.each(copyStyle,function(i,val){mirror.style[val]=$ta.css(val);});}
function adjust(){var height,overflow,original;if(mirrored!==ta){initMirror();}
if(!active){active=true;mirror.value=ta.value+options.append;mirror.style.overflowY=ta.style.overflowY;original=parseInt(ta.style.height,10); mirror.style.width=$ta.width()+'px'; mirror.scrollTop=0;mirror.scrollTop=9e4;height=mirror.scrollTop;if(height>maxHeight){height=maxHeight;overflow='scroll';}else if(height<minHeight){height=minHeight;}
height+=boxOffset;ta.style.overflowY=overflow||hidden;if(original!==height){ta.style.height=height+'px';if(callback){options.callback.call(ta);}}
setTimeout(function(){active=false;},1);}}
if(onpropertychange in ta){if(oninput in ta){ta[oninput]=ta.onkeyup=adjust;}else{ ta[onpropertychange]=adjust;}}else{ ta[oninput]=adjust;ta.value='';ta.value=value;}
$(window).resize(adjust);$ta.bind('autosize',adjust);adjust();});};}(window.jQuery||window.Zepto));var demarcate={};demarcate.markdown={};var _tag_dict={'div':{editable:false,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'','');},},'span':{editable:false,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'','');},},'h1':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'# ','\n\n');},},'h2':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'## ','\n\n');},},'h3':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'### ','\n\n');},},'h4':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'#### ','\n\n');},},'h5':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'##### ','\n\n');},},'h6':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'###### ','\n\n');},},'li':{editable:true,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return demarcate.markdown.base(elem);},},'ul':{editable:false,markdownable:true,allow_newline:true,selector_type:' > ',process:function(elem){return demarcate.markdown.list(elem,'unordered');},},'ol':{editable:false,markdownable:true,allow_newline:true,selector_type:' > ',process:function(elem){return demarcate.markdown.list(elem,'ordered');},},'blockquote':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'> ','\n\n');},},'pre':{editable:true,markdownable:true,allow_newline:true,selector_type:' ',process:function(elem){return demarcate.markdown.code(elem,'','\n\n');},},'code':{editable:false,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return demarcate.markdown.code(elem,'','\n');},},'a':{editable:false,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.link(elem);},},'hr':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'------','\n\n');},},'em':{editable:false,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,' *','* ');},},'strong':{editable:false,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,' **','** ');},},'p':{editable:true,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.base(elem,'','\n\n');},},'table':{editable:false,markdownable:true,allow_newline:false,selector_type:' > ',process:function(elem){return demarcate.markdown.table(elem);},},'th':{editable:true,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return"";}},'td':{editable:true,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return"";}},'br':{editable:false,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return demarcate.markdown.base(elem,'    \n','');},},'img':{editable:false,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return demarcate.markdown.image(elem);},},'span':{editable:false,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return demarcate.markdown.base(elem,'','');},},'sup':{editable:false,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return demarcate.markdown.footnote(elem);},},'_text':{editable:false,markdownable:true,allow_newline:false,selector_type:' ',process:function(elem){return elem===undefined?"":$.trim(elem.text().replace(/\n/g," ").replace(/\s{2,}/g,' '));},},};demarcate.markdown.base=function(elem,prefix,postfix){var result=prefix; result+=demarcate.markdown.parseChildren(elem); return result+postfix;};demarcate.markdown.link=function(elem){ if(elem.hasClass("footnote-backref"))return""; var result=" [";result+=demarcate.markdown.parseChildren(elem);return result+"]("+elem.attr("href")+") ";};demarcate.markdown.list=function(elem,type){var count=1;var result="";$(elem).children("li").each(function(){ if(type=='ordered'){result+=count+". ";count++;}else{result+="- ";} 
result+=demarcate.markdown.parseChildren($(this))+"\n";});return result+"\n";};demarcate.markdown.code=function(elem){ var tag_name=elem.get(0).nodeType==3?'_text':elem.get(0).tagName.toLowerCase();var result=""; if(elem.children().length==0){if(tag_name=="code"){return" `"+elem.text()+"` ";}} 
return"\n\n"+
("    "+elem.text()).replace(/\n/g,"\n    ")+"\n\n";};demarcate.markdown.table=function(elem){var repeatStr=function(str,num)
{return new Array(num+1).join(str);} 
var maxColLen=[];var rowLen=0;var cells=[];var op="";var headerRow=true;var col=0;var row=0; elem.find("tr").each(function(){cells[row]=[];col=0; $(this).children().each(function(){ var contents=$(this).text();var contentLen=contents.length; if(maxColLen.length<=col){maxColLen.push(contentLen);}else{if(contentLen>maxColLen[col]){maxColLen[col]=contentLen;}} 
cells[row][col]=demarcate.markdown.parseChildren($(this));col++;});row++;}); for(var r=0;r<maxColLen.length;r++){rowLen+=maxColLen[r]+1;} 
for(var r=0;r<cells.length;r++){ var row=cells[r];for(var c=0;c<row.length;c++){var cellLen=row[c].length;var padding=maxColLen[c]-cellLen;op+=row[c]+repeatStr(" ",padding)+"|";} 
if(headerRow){op+="\n";for(var i=0;i<maxColLen.length;i++){op+=repeatStr("-",maxColLen[i])+"|";}
headerRow=false;}
op+="\n";}
return op+"\n\n";};demarcate.markdown.image=function(elem){var alt=elem.attr("alt");var title=elem.attr("title");var url=elem.attr("src");var op=" !["+alt+"]("+url;if(title!=""){op+=" \""+title+"\"";}
return op+") ";};demarcate.markdown.footnote=function(elem){var id=elem.attr("id"); var fn_name=id.split(":");if(fn_name.length!==2||fn_name[0]!=="fnref")return""; return" [^"+fn_name[1]+"] ";};demarcate.markdown.footnote_list=function(elem){var result=""; elem.children("ol").children("li").each(function(idx,val){ var fn_name=$(val).attr("id").split(":");if(fn_name.length!==2||fn_name[0]!=="fn")return; result+="[^"+fn_name[1]+"]: "; result+=demarcate.markdown.parseChildren($(val));result+="\n\n";});return result;};demarcate.markdown.parseChildren=function(elem){ var result=""; $.each(elem.contents(),function(index,value){ var node=$(value);var node_type=node.get(0).nodeType;var tag_name=node_type==3?'_text':node.get(0).tagName.toLowerCase();if(tag_name!="_text"){ if(node.hasClass("demarcate_temporary"))return; if(!(tag_name in _tag_dict))return; if((!_tag_dict[tag_name].markdownable)){return;}
if(tag_name=='div'){if(node.hasClass("toc")){result+="\n[TOC]\n\n";return;}else if(node.hasClass("footnote")){result+=demarcate.markdown.footnote_list(node);return;}}} 
result+=_tag_dict[tag_name].process(node);});return result;};demarcate.enable=function(elem){ if(demarcate.dom_root!=null){demarcate.disable(demarcate.dom_root);}
demarcate.dom_root=elem; if(demarcate.current_editor!=null){demarcate.close_editor();}
demarcate.current_editor=null;demarcate.current_element=null;var mapKeyPress=function(e){if(e.keyCode==13){ e.preventDefault();if(e.shiftKey){ demarcate.close_editor();}else if(e.ctrlKey){ demarcate.close_editor(true,true);}else{ if(_tag_dict[demarcate.current_element.get(0).tagName.toLowerCase()].allow_newline){demarcate.current_editor.insertAtCaret("\n");}else{demarcate.close_editor(true,true);}}}else if(e.keyCode==32){ if(e.ctrlKey){e.preventDefault();var next_style=$("div#demarcate_toolbar a.active").next().filter(".demarcate_style");if(next_style.length!=0){ next_style.click();}else{$("div#demarcate_toolbar a.demarcate_style").first().click();}}}else if(e.keyCode==27){ e.preventDefault();demarcate.close_editor(false);}else if(e.keyCode==9){ e.preventDefault();demarcate.current_editor.insertAtCaret("    ");}else if(e.keyCode==40){ if(e.altKey){var next=$("#demarcate_toolbar").next(".demarcate_editable");if(next.length>0){demarcate.close_editor();next.first().click();}}else if(e.ctrlKey){ $("#demarcate_down").click();}}else if(e.keyCode==38){ if(e.altKey){var previous=demarcate.current_element.prev(".demarcate_editable");if(previous.length>0){demarcate.close_editor();previous.first().click();}}else if(e.ctrlKey){ $("#demarcate_up").click();}}};var replaceTag=function(id){var new_elem=$("<"+id+"/>");demarcate.current_element.after(new_elem);demarcate.current_element.remove();demarcate.current_element=new_elem; $("a#demarcate_cancel").fadeOut('fast',function(){this.remove();}); demarcate.current_editor.css("font",demarcate.current_element.css("font")).css("lineHeight",elem.css("lineHeight")).css("margin",demarcate.current_element.css("margin")).css("textAlign",demarcate.current_element.css("textAlign")); if(typeof demarcate.current_editor!=undefined){demarcate.current_editor.autosize({'append':'\n'});} 
demarcate.toolbarSetActive();demarcate.current_editor.focus();}
var enableDemarcateToolbarHandlers=function(){ $(document).on('keydown','#demarcate',mapKeyPress); $(document).bind('mousedown',demarcate.clickElsewhereSave); $(document).on('click','#demarcate_cancel',function(e){e.preventDefault();demarcate.close_editor(false);$(document).trigger('demarcate_editor_closed',[demarcate.current_element]);}); $(document).on('click','#demarcate_save',function(e){e.preventDefault();demarcate.close_editor();}); $(document).on('mouseover','.demarcate_style',function(e){var bg_pos=$(e.target).css('backgroundPosition').split(' ');$(e.target).css('backgroundPosition',bg_pos[0]+" "+(parseInt(bg_pos[1])-72)+"px");}); $(document).on('mouseout','.demarcate_style',function(e){var bg_pos=$(e.target).css('backgroundPosition').split(' ');$(e.target).css('backgroundPosition',bg_pos[0]+" "+(parseInt(bg_pos[1])+72)+"px");}); $(document).on('click','.demarcate_style',function(e){e.preventDefault();var target_tag=$(this).attr('id').replace("demarcate_",""); if(target_tag in _tag_dict){ var current_tag=demarcate.current_element.get(0).tagName.toLowerCase();var parent_tag=demarcate.current_element.parent().get(0).tagName.toLowerCase();if(current_tag=='li'){var par=demarcate.current_element.parent();if(target_tag!='ul'&&target_tag!='ol'){ demarcate.current_element.detach().insertAfter(par);replaceTag(target_tag);}else{var idx=par.index(demarcate.current_element);demarcate.close_editor();var new_list=$("<"+target_tag+">"+par.html()+"</"+target_tag+">");par.replaceWith(new_list);new_list.children("li").get(idx-1).click();}}else if(current_tag!='li'&&(target_tag=='ul'||target_tag=='ol')){var list=$("<"+target_tag+"/>");list.insertBefore(demarcate.current_element);demarcate.current_element.appendTo(list);replaceTag('li');}else{ replaceTag(target_tag);} 
$(".autosizejs").css("font",elem.css("font"));}else{if(target_tag=='help'){alert("SHIFT+ENTER - save your changes\nESCAPE - cancel your changes\n"+"CTRL+ENTER - save your changes, insert a new section\n"+"ENTER - save your changes (or add new line in a code block)\n"+"ALT+UP/DOWN - navigate up and down through elemnts");}}}); $(document).on('click','#demarcate_down',function(e){e.preventDefault();var next=$("#demarcate_toolbar").next(".demarcate_editable");if(next.length>0){next.insertBefore(demarcate.current_element);}
demarcate.current_editor.focus();}); $(document).on('click','#demarcate_up',function(e){e.preventDefault();var previous=demarcate.current_element.prev(".demarcate_editable");if(previous.length>0){previous.insertAfter($("#demarcate_toolbar"));}
demarcate.current_editor.focus();});}; var elem_id=elem.attr('id');for(var tag_name in _tag_dict){if(_tag_dict[tag_name].editable){live_selector="#"+elem_id+
_tag_dict[tag_name].selector_type+tag_name;$(document).on('click',live_selector,function(e){ if($("#demarcate_toolbar").has(e.target).length>0||$("#demarcate_toolbar").is(e.target)||$(elem).attr('id')==='demarcate'){return;} 
demarcate.edit($(this));});$(live_selector).addClass("demarcate_editable");$(document).on('DOMNodeInserted',live_selector,function(e){$(e.target).addClass("demarcate_editable");});}} 
enableDemarcateToolbarHandlers();demarcate.addEditPlaceholder();elem.trigger("demarcate_editor_enabled");};demarcate.disable=function(){ if(demarcate.current_editor!=null){demarcate.close_editor();}
demarcate.current_editor=null;demarcate.current_element=null; $(document).off('keydown','#demarcate');$(document).unbind('mousedown',demarcate.clickElsewhereSave);$(document).off('click','#demarcate_cancel');$(document).off('click','#demarcate_save');$(document).off('mouseover','.demarcate_style');$(document).off('mouseout','.demarcate_style');$(document).off('click','.demarcate_style');$(document).off('click','#demarcate_down');$(document).off('click','#demarcate_up'); var elem_id=demarcate.dom_root.attr("id");for(var tag_name in _tag_dict){if(_tag_dict[tag_name].editable){var selector="#"+elem_id+_tag_dict[tag_name].selector_type+tag_name;$(document).off('click',selector);}} 
$(".demarcate_editable").removeClass("demarcate_editable"); $(".demarcate_temporary").remove(); demarcate.dom_root=null;};demarcate.demarcate=function(elem){if(elem===undefined){elem=demarcate.dom_root;} 
var tag_name=elem.get(0).nodeType==3?"_text":elem.get(0).tagName.toLowerCase(); if(!(tag_name in _tag_dict))return""; result=_tag_dict[tag_name].process(elem);return result;};demarcate.edit=function(elem){var generateToolbar=function(){var toolbar=$("<div />",{id:'demarcate_toolbar'});toolbar.append($("<a />",{id:'demarcate_h1',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h2',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h3',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h4',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h5',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_h6',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_p',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_blockquote',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_ul',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_ol',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_pre',class:'demarcate_style',href:"#"}));toolbar.append($("<p/>"));toolbar.append($("<a />",{id:'demarcate_up',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_down',class:'demarcate_style',href:"#"}));toolbar.append($("<a />",{id:'demarcate_help',class:'demarcate_style',href:"#"}));toolbar.append($("<p/>"));toolbar.append($("<a />",{id:'demarcate_cancel',href:"#"}));toolbar.append($("<a />",{id:'demarcate_save',href:"#"}));return toolbar;}
var display_editor=function(elem){ if(demarcate.current_editor!=null){return;} 
elem=$(elem); var tag_name=elem.get(0).tagName.toLowerCase(); if(tag_name in _tag_dict){ var md="";if(!elem.hasClass("demarcate_temporary")){ if(tag_name=="pre"){md=demarcate.markdown.code(elem);}else{md=demarcate.markdown.parseChildren(elem);}} 
var ed=$("<textarea />",{id:'demarcate'}).css("font",elem.css("font")).css("outline","none").css("margin",elem.css("margin")).css("lineHeight",elem.css("lineHeight")).css("textAlign",elem.css("textAlign"));var tb=generateToolbar();elem.after(tb).slideDown();elem.after(ed).slideDown();elem.addClass("demarcate_hide"); demarcate.current_element=elem;demarcate.current_editor=ed; demarcate.toolbarSetActive(); ed.val(md); if(typeof elem.autosize!=undefined){ed.autosize({'append':'\n'});}
ed.focus(); $("html, body").scrollTop(demarcate.current_editor.offset().top);}}
display_editor(elem);};demarcate.close_editor=function(save_changes,open_new){ if(save_changes===undefined||save_changes===null){save_changes=true;} 
if(open_new===undefined||open_new===null){open_new=false;}
var modifyHtml=function(str){ var strippedText=$("<div/>").html(str).text(); var convertor=new Showdown.converter();var op=convertor.makeHtml(strippedText);return op;}
var doSave=function(){ var tag_name=demarcate.current_element.get(0).tagName.toLowerCase();var curr_value=demarcate.current_editor.val();var new_elem=$("<"+tag_name+"/>");var raw_html=modifyHtml(curr_value); demarcate.current_element.removeClass("demarcate_temporary"); if(raw_html.substring(0,3)=="<p>"){raw_html=raw_html.substring(3,raw_html.length-4);} 
new_elem.html(raw_html); if(tag_name=="th"||tag_name=="td"||tag_name=="li"){demarcate.current_element.html(new_elem.html());}else{new_elem.insertBefore(demarcate.current_element);demarcate.current_element.remove();demarcate.current_element=new_elem;}}
var hideEditor=function(){ $("div#demarcate_toolbar").remove();demarcate.current_editor.remove();demarcate.current_editor=null; if(demarcate.current_element.html()===""&&demarcate.current_element.get(0).tagName!="HR"){demarcate.current_element.remove();}else{demarcate.current_element.removeClass("demarcate_hide");}
demarcate.current_element=null;$(".demarcate_temporary").remove();demarcate.addEditPlaceholder();}
var getNextTableCell=function(elem){var next_td=elem.nextAll("td, th");if(next_td.length==0){var next_tr=elem.parent("tr").nextAll("tr");if(next_tr.length==0){return null;}else{return next_tr.find("th, td").first();}}
return next_td;}
var createNewEditor=function(){ var tag_name=demarcate.current_element.get(0).tagName.toLowerCase();var new_elem=null; if(tag_name=="td"||tag_name=="th"){new_elem=getNextTableCell(demarcate.current_element);}else{new_elem=$("<"+tag_name+"/>");new_elem.insertAfter(demarcate.current_element);} 
doSave();hideEditor();$(".demarcate_temporary").remove(); if(tag_name!="td"&&tag_name!="th"){new_elem.addClass("demarcate_temporary");}
if(new_elem!==null){new_elem.click();}}
if(save_changes){if(open_new){createNewEditor();}else{doSave();hideEditor();}}else{hideEditor()} 
$(document).trigger('demarcate_editor_closed',[demarcate.current_element]);};demarcate.addEditPlaceholder=function(){demarcate.dom_root.append($('<p />',{class:'demarcate_temporary',text:'Click to add a new block'}));};demarcate.toolbarSetActive=function(){var tag_name=""; if(demarcate.current_element==null){return;}else{tag_name=demarcate.current_element.get(0).tagName.toLowerCase();} 
$(".demarcate_style").removeClass("active"); $("#demarcate_"+tag_name).addClass("active");};demarcate.isEnabled=function(){return!(demarcate.dom_root===null);}
demarcate.isActive=function(){return!(demarcate.current_element===null);}
demarcate.clickElsewhereSave=function(e){if(demarcate.current_editor==null)return;var tb=$("#demarcate_toolbar");if(!demarcate.current_editor.is(e.target)&&!tb.is(e.target)&&tb.has(e.target).length===0){demarcate.close_editor();}};(function($){$.fn.insertAtCaret=function(val){ var orig_val=this.val().replace(/\r\n/g,"\n");var start_repl=this.get(0).selectionStart;var end_repl=this.get(0).selectionEnd; var new_val=orig_val.substring(0,start_repl)+val+orig_val.substring(end_repl); this.val(new_val.replace(/\n/g,"\r\n")); this.caretTo(start_repl+val.length);}})(jQuery);(function($){ $.caretTo=function(el,index){if(el.createTextRange){var range=el.createTextRange();range.move("character",index);range.select();}else if(el.selectionStart!=null){el.focus();el.setSelectionRange(index,index);}}; $.fn.caretTo=function(index,offset){return this.queue(function(next){if(isNaN(index)){var i=$(this).val().indexOf(index);if(offset===true){i+=index.length;}else if(offset){i+=offset;}
$.caretTo(this,i);}else{$.caretTo(this,index);}
next();});}; $.fn.caretToStart=function(){return this.caretTo(0);}; $.fn.caretToEnd=function(){return this.queue(function(next){$.caretTo(this,$(this).val().length);next();});};}(jQuery));(function($){$.fn.demarcate=function(){return demarcate.demarcate(this);};})(jQuery);(function($){$.fn.enable_demarcate=function(){demarcate.enable(this);}})(jQuery);(function($){$.fn.disable_demarcate=function(){demarcate.disable();}})(jQuery);