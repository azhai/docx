<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="zh"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="zh"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="zh"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="zh">
<!--<![endif]-->
<head>
<title>安装Linux开发环境之二 —— PHP - docx文档生成工具</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="最简单的方式构建你的项目文档" />
<meta name="author" content="Ryan Liu">
<link rel="icon" href="../assets/img/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="../assets/css/style.min.css">
<style rel="stylesheet">h1 a.html-hidden, div a.html-hidden</style>
<!-- Mobile -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<!-- Docs -->
<a href="https://github.com/azhai/docx" target="_blank" id="github-ribbon" class="hidden-print">
    <img src="../assets/img/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
</a>
<div class="navbar navbar-fixed-top hidden-print">
    <div class="container-fluid">
        <a class="brand navbar-brand pull-left" href="../index.html">docx文档生成工具</a>
        <p class="navbar-text pull-right"> 使用批处理 – Jack D. Herrington </p>
    </div>
</div>

<div class="container-fluid fluid-height wrapper">
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
        <!-- For Mobile -->
<div class="responsive-collapse">
    <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
    <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
    </button>
</div>
<div id="sub-nav-collapse" class="sub-nav-collapse">
    <!-- Navigation -->
    <ul class="nav nav-list">
    <li>
<a href="../index.html">首页</a>
</li>
<li>
<a href="#" class="aj-nav folder">Deploy</a>
<ul class="nav nav-list">
<li>
<a href="../deploy/vim_config.html">VIM配置</a>
</li>
<li>
<a href="../deploy/nginx_case_insensitive.html">让Nginx对URL不区分大小写</a>
</li>
<li>
<a href="../deploy/rsync_config.html">Rsync配置与使用</a>
</li>
<li>
<a href="../deploy/install_postfix.html">安装Postfix邮件服务器</a>
</li>
<li>
<a href="../deploy/nginx_log_cookie.html">Nginx记录访问cookie到日志</a>
</li>
<li>
<a href="../deploy/linux_upstart.html">Linux新的守护进程方式upstart</a>
</li>
<li>
<a href="../deploy/nginx-http_base_auth.html">Nginx设置简单HTTP认证</a>
</li>
<li>
<a href="../deploy/nginx_logrotate.html">Nginx日志按日期切割</a>
</li>
<li>
<a href="../deploy/samba_conf.html">Samba简单配置</a>
</li>
</ul>
</li>
<li class="open">
<a href="#" class="aj-nav folder">CentOS</a>
<ul class="nav nav-list">
<li>
<a href="../centos/centos_install_mysql.html">安装Linux开发环境之一 —— MySQL</a>
</li>
<li class="active">
<a href="../centos/centos_install_php.html">安装Linux开发环境之二 —— PHP</a>
</li>
<li>
<a href="../centos/centos_install_nginx.html">安装Linux开发环境之三 —— Nginx</a>
</li>
<li>
<a href="../centos/centos_install_redis.html">安装Linux开发环境之四 —— Redis</a>
</li>
<li>
<a href="../centos/centos_install_leveldb_beanstalkd.html">安装Linux开发环境之五 —— LevelDB、Beanstalkd</a>
</li>
<li>
<a href="../centos/centos_install_lamp.html">在CentOS上部署lamp环境</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">PHP</a>
<ul class="nav nav-list">
<li>
<a href="../php/zf2-multiple_dbs.html">Zend Framework 2 配置多个数据库</a>
</li>
<li>
<a href="../php/weight_rrd.html">PHP权重轮询</a>
</li>
<li>
<a href="../php/phpunit_boot.html">启动PHPUnit测试的简便方式</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">Python</a>
<ul class="nav nav-list">
<li>
<a href="../python/python_pop3.html">通过POP3协议读取指定邮件</a>
</li>
<li>
<a href="../python/python_pinyin.html">GB2312中文转拼音</a>
</li>
<li>
<a href="../python/python_md5.html">Python计算文件的MD5</a>
</li>
<li>
<a href="../python/python_mulpti_logging.html">Python多进程记录日志</a>
</li>
<li>
<a href="../python/python_paginate.html">一个Python分页</a>
</li>
<li>
<a href="../python/python_urlib.html">Python网址操作函数</a>
</li>
<li>
<a href="../python/python_pymssql_re2.html">安装Python支持SqlServer和re2</a>
</li>
<li>
<a href="../python/python_functions.html">收集用过的一些Python方法</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">Tool</a>
<ul class="nav nav-list">
<li>
<a href="../tool/git_push.html">正确使用git避免提交冲突</a>
</li>
<li>
<a href="../tool/haskell_mysql_dumper.html">MySQL导出CSV文件（Haskell实现）</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">Help</a>
<ul class="nav nav-list">
<li>
<a href="../help/github-flavored-markdown.html">Markdown 语法</a>
</li>
</ul>
</li>    </ul>
    <div class="well well-sidebar">
        <div><a href="#" id="toggleCodeBlockBtn" onclick="toggleCodeBlocks();">外置代码框</a></div>
            </div>
    <div class="well well-sidebar">
        <!-- Links -->
        <div><a href="https://coding.net/u/azhai/p/docx/git" target="_blank">Coding仓库</a></div><div><a href="http://git.oschina.net/azhai/docx" target="_blank">OSChina仓库</a></div><div><a href="http://todaymade.com" target="_blank">Todaymade出品Daux.io</a></div><div><a href="http://blog.emx2.co.uk" target="_blank">Xin Meng翻译文档</a></div>    </div>
</div>        </div>

        <div class="right-column content-area col-sm-9">
            <div class="content-page">
                <article>
                    <div class="page-header sub-header clearfix">
                        <h1>安装Linux开发环境之二 —— PHP
</h1>
                        <span style="float: left; font-size: 10px; color: gray;">
                        标签：linux, php                        </span>
                        <span style="float: right; font-size: 10px; color: gray;">
                        <!--a href="../author/ryan-liu"-->
                        Ryan Liu<!--/a--> 写于 2013年2月20日 星期三                        </span>
                    </div>

                    <blockquote>
<p>2013-4-15更新，使用v5.4.14，增加apc、xdebug和phpunit扩展</p>
</blockquote>
<h2>安装必须组件</h2>
<p>下载 <a href="http://downloads.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fmcrypt%2Ffiles%2FLibmcrypt%2F2.5.8%2F&amp;ts=1361339383&amp;use_mirror=nchc">libmcrypt-2.5.8.tar.gz</a> 并解压</p>
<pre><code class="language-bash">#安装开发库
yum install bzip2-devel gmp-devel openssl-devel curl-devel freetype-devel
yum install libxml2-devel libpng-devel libjpeg-devel libicu-devel libc-client-devel
yum install libtool libtool-ltdl-devel
#安装libmcrypt
wget http://downloads.sourceforge.net/project/mcrypt/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fmcrypt%2Ffiles%2FLibmcrypt%2F2.5.8%2F&amp;ts=1361339383&amp;use_mirror=nchc
tar xzf libmcrypt-2.5.8.tar.gz
cd libmcrypt-2.5.8
./configure
make &amp;&amp; make install
cd ..</code></pre>
<h2>安装PHP</h2>
<p>下载 <a href="http://cn2.php.net/get/php-5.4.14.tar.gz/from/this/mirror">php-5.4.14.tar.gz</a> 解压并进入目录</p>
<pre><code class="language-bash">wget http://cn2.php.net/get/php-5.4.14.tar.gz/from/this/mirror
tar xzf php-5.4.14.tar.gz
cd php-5.4.14
#如果configure报错Note that the MySQL client library is not bundled anymore.
#请将/opt/mysql-5.6.11/lib 建立软连接 /opt/mysql-5.6.11/lib64
#64位Linux
if [ `uname -m` =~ 'x86_64' ]; then
    ln -s /usr/local/lib/libmcrypt.so.4 /usr/local/lib64/libmcrypt.so.4
    ln -s /opt/mysql-5.6.11/lib /opt/mysql-5.6.11/lib64
    gnu_x86_64="--build=x86_64-redhat-linux-gnu --host=x86_64-redhat-linux-gnu --with-libdir=lib64"
else
    gnu_x86_64=""
fi
username=`whoami` #当前用户名

./configure --prefix=/opt/php-5.4.14 \
--with-mysql=/opt/mysql-5.6.11 --with-mysqli=/opt/mysql-5.6.11/bin/mysql_config \
--with-pdo-mysql=/opt/mysql-5.6.11 --with-mysql-sock=/tmp/mysql.sock \
--with-mcrypt=/usr/local --with-zlib \
--with-pic --with-curl=shared --with-freetype-dir --with-png-dir \
--with-gettext=shared --with-gmp=shared --with-iconv --with-jpeg-dir --with-png-dir \
--with-openssl --with-libxml-dir --with-pcre-regex \
--with-kerberos --with-imap --with-imap-ssl \
--with-pear --with-gd --enable-gd-native-ttf --enable-calendar=shared \
--enable-exif --enable-ftp --enable-sockets --enable-bcmath=shared \
--enable-pcntl --enable-intl --enable-mbstring \
--enable-zip --with-bz2=shared \
--enable-sysvsem --enable-sysvshm --enable-sysvmsg \
--without-unixODBC --enable-mbregex \
--enable-tokenizer --disable-phar --with-sqlite3 \
--enable-fpm --with-fpm-user="$username" --with-fpm-group="$username" \
--with-layout=GNU --with-mssql=/opt/freetds-0.91 "$gnu_x86_64"
make &amp;&amp; make install
cd ..</code></pre>
<h2>配置PHP</h2>
<pre><code class="language-bash">#建立软连接
rm -rf /usr/sbin/php-fpm
rm -rf /usr/bin/pear
rm -rf /usr/bin/pecl
rm -rf /usr/bin/php*
ln -s /opt/php-5.4.14/bin/php /usr/bin/php
ln -s /opt/php-5.4.14/bin/phpize /usr/bin/phpize
ln -s /opt/php-5.4.14/bin/pear /usr/bin/pear
ln -s /opt/php-5.4.14/bin/pecl /usr/bin/pecl
ln -s /opt/php-5.4.14/bin/php-config /usr/bin/php-config
ln -s /opt/php-5.4.14/sbin/php-fpm /usr/sbin/php-fpm
#配置文件
mkdir -p /etc/php5/fpm/
cp php-5.4.14/php.ini-production /opt/php-5.4.14/etc/php.ini
cp /opt/php-5.4.14/etc/php-fpm.conf.default /opt/php-5.4.14/etc/php-fpm.conf
ln -s /opt/php-5.4.14/etc/php.ini /etc/php5/fpm/php.ini
ln -s /opt/php-5.4.14/etc/php-fpm.conf /etc/php5/fpm/php-fpm.conf

#修改配置
sed -i '/^max_execution_time/cmax_execution_time = 600' /etc/php5/fpm/php.ini
sed -i '/^error_reporting/cerror_reporting = E_ALL &amp; ~E_DEPRECATED &amp; ~E_NOTICE' /etc/php5/fpm/php.ini
sed -i '/^display_errors/cdisplay_errors = On' /etc/php5/fpm/php.ini
sed -i '/^display_startup_errors/cdisplay_startup_errors = On' /etc/php5/fpm/php.ini
sed -i '/^track_errors/ctrack_errors = On' /etc/php5/fpm/php.ini
sed -i '/^upload_max_filesize/cupload_max_filesize = 20M' /etc/php5/fpm/php.ini
sed -i '/^;date.timezone/cdate.timezone = Asia/Shanghai' /etc/php5/fpm/php.ini

#添加常用扩展
pecl install apc
sed -i '1aextension=apc.so' /etc/php5/fpm/php.ini
pecl install xdebug
#ThreadSafe版本，带有_ts
sed -i '1azend_extension_ts=xdebug.so' /etc/php5/fpm/php.ini

#修改php-fpm的进程数
username=`whoami` #当前用户名
#sed -i "/^user = $username/c#user = $username" /etc/php5/fpm/php-fpm.conf
#sed -i "/^group = $username/c#group = $username" /etc/php5/fpm/php-fpm.conf
sed -i '/^pm.max_children/cpm.max_children = 30' /etc/php5/fpm/php-fpm.conf
sed -i '/^pm.start_servers/cpm.start_servers = 2' /etc/php5/fpm/php-fpm.conf
sed -i '/^pm.min_spare_servers/cpm.min_spare_servers = 2' /etc/php5/fpm/php-fpm.conf
sed -i '/^pm.max_spare_servers/cpm.max_spare_servers = 30' /etc/php5/fpm/php-fpm.conf</code></pre>
<h2>管理PHP</h2>
<pre><code class="language-bash">#启动
php-fpm -c /etc/php5/fpm/php.ini -y /etc/php5/fpm/php-fpm.conf -D
#停止
ps -efww | grep php-fpm | grep -v grep | cut -c 9-15 | xargs kill -9</code></pre>
<blockquote>
<p>2013.3.5更新</p>
</blockquote>
<h2>需要连接SQLServer</h2>
<pre><code class="language-bash">#先安装FreeTDS
wget ftp://ftp.astron.com/pub/freetds/stable/freetds-stable.tgz
tar xzf freetds-stable.tgz
cd freetds-0.91
./configure --prefix=/opt/freetds-0.91 --with-tdsver=8.0 --enable-msdblib
make &amp;&amp; make install
cd ..

#64位系统下（CentOS 6.3有这个问题，其他发行版不知道是不是也这样），还需要
if [ `uname -m` =~ 'x86_64' ]; then
    ln -s /opt/freetds-0.91/lib /opt/freetds-0.91/lib64
fi

#再来编译安装PHP，配置参数参考上面，在末尾多加一个 --with-mssql=/opt/freetds-0.91</code></pre>                </article>
            </div>
        </div>

    </div>
</div>

<script src="../assets/js/jquery.min.js"></script> 
<script src="../assets/js/custom.js"></script> 
<!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- hightlight.js -->
<script src="../assets/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>