<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="zh"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="zh"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="zh"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="zh">
<!--<![endif]-->
<head>
<title>安装Postfix邮件服务器 - docx文档生成工具</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="最简单的方式构建你的项目文档" />
<meta name="author" content="Ryan Liu">
<link rel="icon" href="../assets/img/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="../assets/css/style.min.css">
<style rel="stylesheet">h1 a.html-hidden, div a.html-hidden</style>
<!-- Mobile -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<!-- Docs -->
<a href="https://github.com/azhai/docx" target="_blank" id="github-ribbon" class="hidden-print">
    <img src="../assets/img/forkme_right_darkblue_121621.png" alt="Fork me on GitHub">
</a>
<div class="navbar navbar-fixed-top hidden-print">
    <div class="container-fluid">
        <a class="brand navbar-brand pull-left" href="/docx/index.php">docx文档生成工具</a>
        <p class="navbar-text pull-right"> 利用好PHP的过滤函数 – Joey Sochacki </p>
    </div>
</div>

<div class="container-fluid fluid-height wrapper">
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
        <!-- For Mobile -->
<div class="responsive-collapse">
    <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
    <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
    </button>
</div>
<div id="sub-nav-collapse" class="sub-nav-collapse">
    <!-- Navigation -->
    <ul class="nav nav-list">
    <li>
<a href="../index.html">首页</a>
</li>
<li class="open">
<a href="#" class="aj-nav folder">Deploy</a>
<ul class="nav nav-list">
<li>
<a href="../deploy/vim_config.html">VIM配置</a>
</li>
<li>
<a href="../deploy/nginx_case_insensitive.html">让Nginx对URL不区分大小写</a>
</li>
<li>
<a href="../deploy/rsync_config.html">Rsync配置与使用</a>
</li>
<li class="active">
<a href="../deploy/install_postfix.html">安装Postfix邮件服务器</a>
</li>
<li>
<a href="../deploy/nginx_log_cookie.html">Nginx记录访问cookie到日志</a>
</li>
<li>
<a href="../deploy/linux_upstart.html">Linux新的守护进程方式upstart</a>
</li>
<li>
<a href="../deploy/nginx-http_base_auth.html">Nginx设置简单HTTP认证</a>
</li>
<li>
<a href="../deploy/nginx_logrotate.html">Nginx日志按日期切割</a>
</li>
<li>
<a href="../deploy/samba_conf.html">Samba简单配置</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">CentOS</a>
<ul class="nav nav-list">
<li>
<a href="../centos/centos_install_mysql.html">安装Linux开发环境之一 —— MySQL</a>
</li>
<li>
<a href="../centos/centos_install_php.html">安装Linux开发环境之二 —— PHP</a>
</li>
<li>
<a href="../centos/centos_install_nginx.html">安装Linux开发环境之三 —— Nginx</a>
</li>
<li>
<a href="../centos/centos_install_redis.html">安装Linux开发环境之四 —— Redis</a>
</li>
<li>
<a href="../centos/centos_install_leveldb_beanstalkd.html">安装Linux开发环境之五 —— LevelDB、Beanstalkd</a>
</li>
<li>
<a href="../centos/centos_install_lamp.html">在CentOS上部署lamp环境</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">PHP</a>
<ul class="nav nav-list">
<li>
<a href="../php/zf2-multiple_dbs.html">Zend Framework 2 配置多个数据库</a>
</li>
<li>
<a href="../php/weight_rrd.html">PHP权重轮询</a>
</li>
<li>
<a href="../php/phpunit_boot.html">启动PHPUnit测试的简便方式</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">Python</a>
<ul class="nav nav-list">
<li>
<a href="../python/python_pop3.html">通过POP3协议读取指定邮件</a>
</li>
<li>
<a href="../python/python_pinyin.html">GB2312中文转拼音</a>
</li>
<li>
<a href="../python/python_md5.html">Python计算文件的MD5</a>
</li>
<li>
<a href="../python/python_mulpti_logging.html">Python多进程记录日志</a>
</li>
<li>
<a href="../python/python_paginate.html">一个Python分页</a>
</li>
<li>
<a href="../python/python_urlib.html">Python网址操作函数</a>
</li>
<li>
<a href="../python/python_pymssql_re2.html">安装Python支持SqlServer和re2</a>
</li>
<li>
<a href="../python/python_functions.html">收集用过的一些Python方法</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">Tool</a>
<ul class="nav nav-list">
<li>
<a href="../tool/git_push.html">正确使用git避免提交冲突</a>
</li>
<li>
<a href="../tool/haskell_mysql_dumper.html">MySQL导出CSV文件（Haskell实现）</a>
</li>
</ul>
</li>
<li>
<a href="#" class="aj-nav folder">Help</a>
<ul class="nav nav-list">
<li>
<a href="../help/github-flavored-markdown.html">Markdown 语法</a>
</li>
</ul>
</li>    </ul>
    <div class="well well-sidebar">
        <div><a href="#" id="toggleCodeBlockBtn" onclick="toggleCodeBlocks();">外置代码框</a></div>
            </div>
    <div class="well well-sidebar">
        <!-- Links -->
        <div><a href="https://coding.net/u/azhai/p/docx/git" target="_blank">Coding仓库</a></div><div><a href="http://git.oschina.net/azhai/docx" target="_blank">OSChina仓库</a></div><div><a href="http://todaymade.com" target="_blank">Todaymade出品Daux.io</a></div><div><a href="http://blog.emx2.co.uk" target="_blank">Xin Meng翻译文档</a></div>    </div>
</div>        </div>

        <div class="right-column content-area col-sm-9">
            <div class="content-page">
                <article>
                    <div class="page-header sub-header clearfix">
                        <h1>安装Postfix邮件服务器
</h1>
                        <span style="float: left; font-size: 10px; color: gray;">
                        标签：postfix, mail, server                        </span>
                        <span style="float: right; font-size: 10px; color: gray;">
                        <!--a href="/docx/index.phpauthor/ryan-liu"-->
                        Ryan Liu<!--/a--> 写于 2013年4月16日 星期二                        </span>
                    </div>

                    <h2>安装Postfix</h2>
<p>下载 <a href="ftp://ftp.cuhk.edu.hk/pub/packages/mail-server/postfix/official/postfix-2.10.0.tar.gz">postfix-2.10.0</a> </p>
<p><a href="ftp://ftp.cyrusimap.org/cyrus-sasl/cyrus-sasl-2.1.26.tar.gz">cyrus-sasl-2.1.26</a> </p>
<p><a href="ftp://ftp.cyrusimap.org/cyrus-imapd/cyrus-imapd-2.4.17.tar.gz">cyrus-imapd-2.4.17</a> </p>
<pre><code>yum install openssl db4-devel libsnmp-devel
yum -y install perl-CPAN
wget ftp://ftp.cuhk.edu.hk/pub/packages/mail-server/postfix/official/postfix-2.10.0.tar.gz
wget ftp://ftp.cyrusimap.org/cyrus-sasl/cyrus-sasl-2.1.26.tar.gz
wget ftp://ftp.cyrusimap.org/cyrus-imapd/cyrus-imapd-2.4.17.tar.gz

#创建用户
useradd -M -s /bin/false -p* postfix
groupadd postdrop
#安装cyrus-sasl
tar xzf cyrus-sasl-2.1.26.tar.gz
cd cyrus-sasl-2.1.26
./configure --prefix=/opt/cyrus/cyrus-sasl-2.1.26 \
        --enable-login --enable-ntlm
make &amp;&amp; make install
cd ..
#安装cyrus-imapd
tar xzf cyrus-imapd-2.4.17.tar.gz
cd cyrus-imapd-2.4.17
./configure --prefix=/opt/cyrus/cyrus-imapd-2.4.17 --with-lock=fcntl \
        --with-sasl=/opt/cyrus/cyrus-sasl-2.1.26 \
        --with-openssl
make &amp;&amp; make install
cd ..

#安装postfix
tar xzf postfix-2.10.0.tar.gz
cd postfix-2.10.0
if [ `uname -m` =~ &amp;#39;x86_64&amp;#39; ]; then
    ln -s /opt/cyrus/cyrus-sasl-2.1.26/lib/libsasl2.so.3.0.0 /usr/lib64/libsasl2.so.3
else
    ln -s /opt/cyrus/cyrus-sasl-2.1.26/lib/libsasl2.so.3.0.0 /usr/lib/libsasl2.so.3
fi
make makefiles --always-make CCARGS=&amp;#39;-I/opt/cyrus/cyrus-sasl-2.1.26/include/sasl \
        -DDEF_CONFIG_DIR=\&amp;#34;/etc/postfix\&amp;#34; -DFD_SETSIZE=2048 -DUSE_CYRUS_SASL -DUSE_TLS&amp;#39; \
        AUXLIBS=&amp;#39;-L/opt/cyrus/cyrus-sasl-2.1.26/lib/sasl2 -lssl -lcrypto&amp;#39;
make
make install

#postfix2.7的问题
#安装过程中需要回答问题，下面三个问题，请使用右边的回答，其他直接按回车用默认值
#  [/usr/bin/mailq]                     /usr/bin/mailq.postfix
#  [/usr/bin/newaliases]                /usr/bin/newaliases.postfix
#  [/usr/sbin/sendmail]                 /usr/sbin/sendmail.postfix

#postfix-2.10的问题，一路回车使用默认值
#install_root: [/]
#tempdir: [/home/xxx/yyy/postfix-2.10.0]
#config_directory: []
#command_directory: [/usr/sbin]
#daemon_directory: [/usr/libexec/postfix]
#data_directory: [/var/lib/postfix]
#html_directory: [no]
#mail_owner: [postfix]
#mailq_path: [/usr/bin/mailq]
#manpage_directory: [/usr/local/man]
#newaliases_path: [/usr/bin/newaliases]
#queue_directory: [/var/spool/postfix]
#readme_directory: [no]
#sendmail_path: [/usr/sbin/sendmail]
#setgid_group: [postdrop]

cd ..</code></pre>
<h2>配置postfix</h2>
<pre><code># 添加以下内容到main.cf echo [BELOW TEXT] &gt;&gt; /etc/postfix/main.cf
local_recipient_maps =
#请将所有的mail.example.com和example.com替换为您的MX域名
###############postfix#################################
myhostname = mail.example.com
myorigin = example.com
mydomain = example.com
append_dot_mydomain = no
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
#mynetworks = 192.168.1.0/24, 10.0.0.0/24, 127.0.0.0/8
mynetworks = 127.0.0.1, 192.168.0.0/24  #只接收本机和局域网的邮件
#body_checks = regexp:/etc/postfix/body_checks  #用于从邮件中提取信息记录到postfix日志

############################CYRUS-SASL############################
broken_sasl_auth_clients = yes
smtpd_recipient_restrictions=permit_mynetworks,permit_sasl_authenticated,reject_invalid_hostname,reject_non_fqdn_hostname,reject_unknown_sender_domain,reject_non_fqdn_sender,reject_non_fqdn_recipient,reject_unknown_recipient_domain,reject_unauth_pipelining,reject_unauth_destination
smtpd_sasl_auth_enable = yes
smtpd_sasl_local_domain = $myhostname
smtpd_sasl_security_options = noanonymous
#postfix v2.9以上请注释下面这行，否则启动postfix时弹出警告信息
#smtpd_sasl_application_name = smtpd
smtpd_banner = Welcome to our $myhostname ESMTP,Warning: Version not Available!

# echo [BELOW TEXT] &gt; /etc/postfix/smtpd.conf
echo &amp;#34;pwcheck_method: saslauthd&amp;#34; &gt;&gt; /etc/postfix/smtpd.conf
echo &amp;#34;mech_list: PLAIN LOGIN&amp;#34; &gt;&gt; /etc/postfix/smtpd.conf

# echo [BELOW TEXT] &gt;&gt; /etc/postfix/body_checks
/\/account\/([a-z_]+)\/veri/  WARN &amp;#34;$1&amp;#34;
/verify=3D([0-9a-f]+)/  WARN &amp;#34;$1&amp;#34;

# 设置
rm -f /usr/sbin/sendmail
ln -s /usr/sbin/sendmail.postfix /usr/sbin/sendmail
rm -f /etc/alternatives/mta
ln -s /usr/sbin/sendmail.postfix /etc/alternatives/mta

rm -f /usr/sbin/saslauthd
ln -s /opt/cyrus/cyrus-sasl-2.1.26/sbin/saslauthd /usr/sbin/saslauthd
rm -rf /etc/postfix
ln -s /etc/postfix /etc/postfix</code></pre>
<h2>启动、测试、过滤日志</h2>
<pre><code># 启动
#如果没有chkconfig，请用sysv-rc-conf代替
#apt-get install sysv-rc-conf
/etc/rc.d/init.d/sendmail stop
chkconfig sendmail off
chkconfig --list sendmail
chkconfig saslauthd on
chkconfig --list saslauthd
/etc/rc.d/init.d/saslauthd start
postfix start

# 测试，收件人为who@where.com
telnet localhost 25
EHLO mail.example.com
MAIL FROM:admin@example.com
RCPT TO:who@where.com NOTIFY=success,failure
DATA
subject:Mail test!
This is just a mail test!!!
.
#上面单独一行的点表示消息结束

#从日志中统计退回、拒收、超时失败的邮件
#grep &amp;#34;status=bounced&amp;#34; /var/log/maillog | gawk &amp;#39;match($0,/to=/){print substr($0,RSTART+4,RLENGTH-5)}&amp;#39;
#grep &amp;#34;status=deferred&amp;#34; /var/log/maillog | gawk &amp;#39;match($0,/to=/){print substr($0,RSTART+4,RLENGTH-5)}&amp;#39;
#grep &amp;#34;status=expired&amp;#34; /var/log/maillog | gawk &amp;#39;match($0,/to=/){print substr($0,RSTART+4,RLENGTH-5)}&amp;#39;</code></pre>                </article>
            </div>
        </div>

    </div>
</div>

<script src="../assets/js/jquery.min.js"></script> 
<script src="../assets/js/custom.js"></script> 
<!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- hightlight.js -->
<script src="../assets/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>